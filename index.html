<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-markdown data-separator-vertical="^\r?\n--\r?\n$">
					<textarea data-template>
## Debugging GitHub Actions locally
notes:
- let's assume you have a repo with a GHA: checks/tests on each push
- was running fine, but something happened
- GHA breaks, cannot reproduce error locally
- you code a potential fix in the dark (locally everything works), push and wait...
- 20 min later, GHA failed, you try again...
- then you run out of ideas and start putting `print` statements everywhere, push again...
- at the end of your workday your commit history shows 20 commits each with a red GHA-failed cross
- you are reminded of the time when you were learning to program, nothing seemed to work and it was frustrating as hell
- and the worst thing: you still have no idea what's going wrong
- luckily, there's a better way, and we'll take a look at that now

https://rsecon2022.society-rse.org/walkthroughs/
30 min presentation, 15 min questions

--

### Requirements
- git
- GitHub
- commandline debugging
- optional: CI testing

--

### Learning objectives
- setup, run, and debug GitHub Action locally

---

## Motivation

--

### why CI testing?
- run checks/tests on PR/push
- prevent broken projects, especially problematic if many devs/users
- ensure setup works on fresh machine
- code quality standard

--

### why GitHub Actions?
- Actions are easy to setup & free
- Actions = code -> will break eventually, and then?
- debugging! <!-- .element: class="fragment" data-fragment-index="2" -->
- is quite tricky here :( <!-- .element: class="fragment" data-fragment-index="3" -->
notes:
shoutout to GitHub, amazing service for free!

--

### why is debugging Actions tricky?
- Action runs on a GitHub server -> non-interactive
- trial & error? upload tons of commits + print debugging?
- nope: nektos/act <!-- .element: class="fragment" data-fragment-index="2" -->

---

## Setup repo
- create [repo including Action](https://github.com/pfuehrlich-pik/GitHub-Action-Example)
- follow Action running in browser

notes:
let's reproduce this locally

--

## Setup nektos/act
- install [docker](https://www.docker.com/)
- install [act](https://github.com/nektos/act#installation)
- optional: download [GitHub Actions docker image](https://github.com/nektos/act#runners) (18GB)

```sh
$ docker pull ghcr.io/catthehacker/ubuntu:full-latest
```

notes:
- when Action runs on GitHub server, runs in sandbox/virtual system with e.g. basic ubuntu
- want to reproduce locally -> need same system -> docker image
- use to create container: virtual system, can have different tools/OS running there

---

## Debug Action locally
```sh
# run Action locally
$ act -P ubuntu-latest=ghcr.io/catthehacker/ubuntu:full-latest

# list running containers
$ docker ps

# open bash in container
$ docker exec -it <container-name-or-id> bash

# commandline debugging
```

notes:
- compare local vs in docker: interactive R session, `source("script.R")`, `str(x)`
- difference = `factor` vs `chr` -> explicitly set `stringsAsFactors = TRUE`
- upload to GitHub
- push fix to GitHub
- open running Action in browser
- back to presentation, next slide

---

## Wrap-up
- CI testing with GitHub Actions is great
- trial & error debugging is terrible
- recreated server environment locally <!-- .element: class="fragment" data-fragment-index="2" -->
- ran Action locally <!-- .element: class="fragment" data-fragment-index="2" -->
- solved problem with proper debugging tools  <!-- .element: class="fragment" data-fragment-index="2" -->
- also helpful for developing new Action!  <!-- .element: class="fragment" data-fragment-index="3" -->

notes:
- switch back to succeeded Action
- then next slide

---

## time for questions
- [GitHub: pfuehrlich-pik](https://github.com/pfuehrlich-pik)
- [mail: pascal.fuehrlich@pik-potsdam.de](mailto:pascal.fuehrlich@pik-potsdam.de)

					</textarea>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
